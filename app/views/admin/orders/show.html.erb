<h1>注文詳細画面(ステータス編集を兼ねる)</h1>

<h2>注文履歴詳細</h2>

<%= form_with model: @order, url: admin_order_path, method: :PATCH, local: true do |f| %>
  <table style:"border:none;">
    <tr style:"border:none;">
      <th style:"border:none;">購入者</th>
      <td style:"border:none;"><%= @order.customer.full_name %></td>
    </tr>
    
    <tr style:"border:none;">
      <th style:"border:none;">注文日</th>
      <td style:"border:none;"><%= @order.created_at.strftime("%Y-%m-%d %H:%M:%S") %></td>
    </tr>
    
    <tr style:"border:none;">
      <th style:"border:none;">配送先</th>
      <td style:"border:none;"><%= @order.postal_code %></td>
    </tr>
    
    <tr style:"border:none;">
      <th style:"border:none;">支払い方法</th>
      <td style:"border:none;"><%= @order.payment_method_i18n %></td>
    </tr>
    
    <tr style:"border:none;">
      <th style:"border:none;">注文ステータス</th>
      <td>
        <%= f.select :status, Order.statuses_i18n.invert %>
        <%= f.submit "更新", class: "btn btn-outline-success" %>
      </td>
    </tr>
    
  </table>
<% end %>

  <table>
    <tr>
      <th>商品名</th>
      <th>単価（税込）</th>
      <th>数量</th>
      <th>小計</th>
      <th>製作ステータス</th>
    </tr>
    
  <% @order.order_histories.each do |order_history| %>

    <tr>
      <td><%= order_history.item.name %></td>
      <td><%= ((order_history.item.price * 1.1).round(2)).ceil.to_s(:delimited) %>円</td>
      <td><%= order_history.amount %>個</td>
      <td><%= ((order_history.price * 1.1).round(2)).ceil.to_s(:delimited) * order_history.amount %>円</td>
    　<td>
    　   <%= form_with model: order_history, url: admin_order_order_history_path(@order.id, order_history.id), method: :PATCH, local: true do |f| %>
        <%= f.select :making_status, OrderHistory.making_statuses_i18n.invert %>
        <%= f.submit "更新", class: "btn btn-outline-success" %>
          </td>
    　</td>
    </tr>
    
  <% end %>
  </table>

  <table style:"border:none;">
    <tr style:"border:none;">
      <th style:"border:none;">商品合計</th>
      <td style:"border:none;"><%= @order.total_payment.round(2).ceil.to_s(:delimited) %>円</td>
    </tr>
    
    <tr style:"border:none;">
      <th style:"border:none;">送料</th>
      <td style:"border:none;"><%= 800 %>円</td>
    </tr>
    
    <tr style:"border:none;">
      <th style:"border:none;">請求合計金額</th>
      <td style:"border:none;"><%= (800 + @order.total_payment).round(2).ceil.to_s(:delimited) %>円</td>
    </tr>
    
  </table>
<% end %>